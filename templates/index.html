<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jira AI Assistant with Oracle DB & Elasticsearch</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <div class="header">
            <!-- Logo Section -->
            <div class="header-logo">
                <!-- You can replace this with an actual image -->
                <!-- <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo" style="width: 100%; height: 100%; object-fit: contain;"> -->
                
                <!-- Or use text/icon as placeholder -->
                <span>AI</span>
            </div>
            
            <!-- Header Content -->
            <div class="header-content">
                <h1>🤖 Jira AI Assistant</h1>
                <p>AI-powered Jira queries with Oracle DB validation, Elasticsearch log analysis & Fraud detection</p>
            </div>
        </div>

        <div class="status-bar">
            <div class="status-indicator"></div>
            <span>✅ Connected to Jira, Oracle DB, Elasticsearch & OpenAI - Ready to process your queries</span>
        </div>

        <div class="main-content">
            <div class="chat-container" id="chatContainer">
                <div class="welcome-message">
                    <h2>Welcome to your Enhanced Jira AI Assistant! 👋</h2>
                    <p>Your Jira, Oracle DB, Elasticsearch and AI connections are configured and ready. Choose your operation:</p>
                    
                    <div class="feature-tabs">
                        <button class="tab-button active" onclick="showTab('jira')">
                            📋 Jira Queries
                        </button>
                        <button class="tab-button" onclick="showTab('validation')">
                            🔍 Order Validation
                        </button>
                        <button class="tab-button" onclick="showTab('security')">
                            🛡️ Security Analysis
                        </button>
                        <button class="tab-button" onclick="showTab('logs')">
                            📊 Log Analysis
                        </button>
                        <button class="tab-button" onclick="showTab('fraud')">
                            🚨 Fraud Analysis
                        </button>
                        <button class="tab-button" onclick="showTab('jenkins')">
                            🔧 Jenkins Jobs
                        </button>
                    </div>

                    <div class="tab-content" id="jira-tab">
                        <h3>Jira Query Examples</h3>
                        <div class="example-queries">
                            <div class="example-query" onclick="useExampleQuery(this)">
                                <h4>📋 Find Stories by Assignee</h4>
                                <p>Show me all stories assigned to John Smith</p>
                            </div>
                            <div class="example-query" onclick="useExampleQuery(this)">
                                <h4>🐛 Search by Issue Type</h4>
                                <p>Find all bugs in the DEV project</p>
                            </div>
                            <div class="example-query" onclick="useExampleQuery(this)">
                                <h4>📈 Status Filtering</h4>
                                <p>What are the open epics for this sprint?</p>
                            </div>
                            <div class="example-query" onclick="useExampleQuery(this)">
                                <h4>📅 Date Range Queries</h4>
                                <p>Show me stories created in the last week</p>
                            </div>
                        </div>
                    </div>

                    <div class="tab-content hidden" id="validation-tab">
                        <h3>Order Validation</h3>
                        <div class="validation-form">
                            <div class="form-group">
                                <label for="orderNumber">Order Number:</label>
                                <input type="text" id="orderNumber" placeholder="e.g., ORD-123456, ORDER_789" maxlength="20">
                            </div>
                            <div class="form-group">
                                <label for="locationCode">Location Code:</label>
                                <input type="text" id="locationCode" placeholder="e.g., NYC, LA, CHI" maxlength="5">
                            </div>
                            <button class="validate-button" onclick="validateOrder()">
                                🔍 Validate Order
                            </button>
                        </div>
                    </div>

                    <div class="tab-content hidden" id="security-tab">
                        <h3>Security Impact Analysis</h3>
                        <div class="security-form">
                            <div class="form-group">
                                <label for="issueKey">Issue Key:</label>
                                <input type="text" id="issueKey" placeholder="e.g., PROJ-123, DEV-456" maxlength="20">
                            </div>
                            <button class="analyze-button" onclick="analyzeIssueSecurity()">
                                🛡️ Analyze Security Impact
                            </button>
                        </div>
                    </div>

                    <div class="tab-content hidden" id="logs-tab">
                        <h3>Log Analysis Options</h3>
                        <div class="log-analysis-options">
                            <div class="log-option" onclick="showLogForm('3d-secure')">
                                <div class="log-option-icon">🔐</div>
                                <h4>3D Secure</h4>
                                <p>Analyze 3D Secure authentication logs and transactions</p>
                            </div>
                            <div class="log-option" onclick="showLogForm('enforce-xml6')">
                                <div class="log-option-icon">📋</div>
                                <h4>Enforce XML6</h4>
                                <p>Review XML6 enforcement logs and compliance data</p>
                            </div>
                            <div class="log-option" onclick="showLogForm('full-auth')">
                                <div class="log-option-icon">🔑</div>
                                <h4>Full Auth</h4>
                                <p>Examine full authentication flow logs and results</p>
                            </div>
                            <div class="log-option" onclick="showLogForm('payment-gateway')">
                                <div class="log-option-icon">💳</div>
                                <h4>Payment Gateway</h4>
                                <p>Analyze payment gateway transaction logs</p>
                            </div>
                            <div class="log-option" onclick="showLogForm('fraud-detection')">
                                <div class="log-option-icon">🚨</div>
                                <h4>Fraud Detection</h4>
                                <p>Review fraud detection system logs and alerts</p>
                            </div>
                            <div class="log-option" onclick="showLogForm('api-gateway')">
                                <div class="log-option-icon">🌐</div>
                                <h4>API Gateway</h4>
                                <p>Monitor API gateway access and performance logs</p>
                            </div>
                        </div>
                    </div>

                    <div class="tab-content hidden" id="jenkins-tab">
                        <h3>Jenkins Job Management</h3>
                        <p style="color: #cccccc; margin-bottom: 25px; text-align: center; font-size: 1rem;">
                            Automated job execution and monitoring with real-time status updates
                        </p>
                        <div class="jenkins-jobs-options">
                            <div class="jenkins-job-option" onclick="showJenkinsJobForm('fraud_story_prediction')">
                                <div class="jenkins-job-icon">🤖</div>
                                <h4>Fraud Story Prediction</h4>
                                <p>AI-powered fraud story prediction based on enterprise release data with automated email notifications</p>
                                <div style="margin-top: 10px; font-size: 0.7rem; color: #888;">
                                    <strong>Parameters:</strong> Enterprise Release, Email ID
                                </div>
                                <div style="margin-top: 5px; font-size: 0.7rem; color: #888;">
                                    <strong>Runtime:</strong> 5-10 minutes • <strong>Output:</strong> Email report
                                </div>
                            </div>
                            
                            <!-- Placeholder for future Jenkins jobs -->
                            <div class="jenkins-job-option disabled" style="opacity: 0.5; cursor: not-allowed;" title="Coming Soon">
                                <div class="jenkins-job-icon">📊</div>
                                <h4>Performance Analysis</h4>
                                <p>Automated performance testing and analysis with detailed reporting</p>
                                <div style="margin-top: 10px; font-size: 0.7rem; color: #888;">
                                    <strong>Status:</strong> Coming Soon
                                </div>
                            </div>
                            
                            <div class="jenkins-job-option disabled" style="opacity: 0.5; cursor: not-allowed;" title="Coming Soon">
                                <div class="jenkins-job-icon">🔄</div>
                                <h4>Deployment Pipeline</h4>
                                <p>Automated deployment with rollback capabilities and monitoring</p>
                                <div style="margin-top: 10px; font-size: 0.7rem; color: #888;">
                                    <strong>Status:</strong> Coming Soon
                                </div>
                            </div>
                        </div>
                        
                        <!-- Jenkins Connection Status -->
                        <div style="margin-top: 30px; padding: 20px; background: linear-gradient(135deg, #1a2d1a, #2d3a2d); border: 1px solid #00ff88; border-radius: 12px;">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                                <span style="font-size: 1.5rem;">🔧</span>
                                <h4 style="color: #00ff88; margin: 0;">Jenkins Integration</h4>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; font-size: 0.8rem;">
                                <div style="padding: 8px; background: rgba(0,255,136,0.1); border-radius: 6px;">
                                    <strong style="color: #00ff88;">🎯 Automated Execution</strong><br>
                                    <span style="color: #ccc;">Parameterized job triggering with validation</span>
                                </div>
                                <div style="padding: 8px; background: rgba(0,255,136,0.1); border-radius: 6px;">
                                    <strong style="color: #00ff88;">📧 Email Notifications</strong><br>
                                    <span style="color: #ccc;">Results delivered directly to your inbox</span>
                                </div>
                                <div style="padding: 8px; background: rgba(0,255,136,0.1); border-radius: 6px;">
                                    <strong style="color: #00ff88;">⏱️ Real-time Status</strong><br>
                                    <span style="color: #ccc;">Live job monitoring and progress tracking</span>
                                </div>
                                <div style="padding: 8px; background: rgba(0,255,136,0.1); border-radius: 6px;">
                                    <strong style="color: #00ff88;">🔒 Secure Access</strong><br>
                                    <span style="color: #ccc;">Token-based authentication and authorization</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-content hidden" id="fraud-tab">
                        <h3>AI-Powered Fraud Analysis</h3>
                        <p style="color: #cccccc; margin-bottom: 25px; text-align: center; font-size: 1rem;">
                            Advanced fraud detection using Gen AI to analyze API calls, detect patterns, and assess risks
                        </p>
                        <div class="fraud-analysis-options">
                            <div class="fraud-option" onclick="showFraudForm('digital_fraud')">
                                <div class="fraud-option-icon">🤖</div>
                                <h4>Digital Fraud</h4>
                                <p>AI analysis of automated/bot-driven fraudulent activities and device fingerprinting patterns</p>
                                <div style="margin-top: 10px; font-size: 0.7rem; color: #888;">
                                    <strong>AI Features:</strong> Bot detection, Device analysis, Automation patterns
                                </div>
                            </div>
                            <div class="fraud-option" onclick="showFraudForm('assisted_fraud')">
                                <div class="fraud-option-icon">👥</div>
                                <h4>Assisted Fraud</h4>
                                <p>AI analysis of human-assisted fraudulent activities and social engineering patterns</p>
                                <div style="margin-top: 10px; font-size: 0.7rem; color: #888;">
                                    <strong>AI Features:</strong> Behavioral analysis, Social engineering detection, Human patterns
                                </div>
                            </div>
                            <div class="fraud-option" onclick="showFraudForm('transaction_fraud')">
                                <div class="fraud-option-icon">💳</div>
                                <h4>Transaction Fraud</h4>
                                <p>AI analysis of suspicious transaction patterns and payment anomalies</p>
                                <div style="margin-top: 10px; font-size: 0.7rem; color: #888;">
                                    <strong>AI Features:</strong> Payment analysis, Velocity patterns, Amount anomalies
                                </div>
                            </div>
                            <div class="fraud-option" onclick="showFraudForm('identity_fraud')">
                                <div class="fraud-option-icon">🆔</div>
                                <h4>Identity Fraud</h4>
                                <p>AI analysis of identity theft, impersonation and synthetic identity fraud</p>
                                <div style="margin-top: 10px; font-size: 0.7rem; color: #888;">
                                    <strong>AI Features:</strong> Identity verification, Document analysis, Synthetic detection
                                </div>
                            </div>
                        </div>
                        
                        <!-- AI Features Highlight -->
                        <div style="margin-top: 30px; padding: 20px; background: linear-gradient(135deg, #1a2d1a, #2d3a2d); border: 1px solid #00ff88; border-radius: 12px;">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                                <span style="font-size: 1.5rem;">🤖</span>
                                <h4 style="color: #00ff88; margin: 0;">AI-Powered Analysis Capabilities</h4>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; font-size: 0.8rem;">
                                <div style="padding: 8px; background: rgba(0,255,136,0.1); border-radius: 6px;">
                                    <strong style="color: #00ff88;">🎯 API Call Analysis</strong><br>
                                    <span style="color: #ccc;">Purpose identification, Response analysis, Error detection</span>
                                </div>
                                <div style="padding: 8px; background: rgba(0,255,136,0.1); border-radius: 6px;">
                                    <strong style="color: #00ff88;">⚠️ Risk Assessment</strong><br>
                                    <span style="color: #ccc;">Pattern recognition, Anomaly detection, Threat scoring</span>
                                </div>
                                <div style="padding: 8px; background: rgba(0,255,136,0.1); border-radius: 6px;">
                                    <strong style="color: #00ff88;">💡 Smart Insights</strong><br>
                                    <span style="color: #ccc;">Business impact analysis, Actionable recommendations</span>
                                </div>
                                <div style="padding: 8px; background: rgba(0,255,136,0.1); border-radius: 6px;">
                                    <strong style="color: #00ff88;">📊 Tabular Display</strong><br>
                                    <span style="color: #ccc;">Organized results, Sortable data, Export capabilities</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button class="tab-btn" onclick="showSecurityAnalysis()">
                        🔒 Security Analysis
                    </button>
                </div>
            </div>

            <div class="input-container">
                <div class="input-wrapper">
                    <textarea id="queryInput" placeholder="Ask me about your Jira issues, validate orders, analyze security, or investigate fraud... Type your question here!" rows="1"></textarea>
                </div>
                <button class="send-button" onclick="sendQuery()" id="sendButton">
                    ➤
                </button>
            </div>
        </div>
    </div>

    <!-- Load JavaScript files -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    
    <!-- Additional inline scripts for fraud analysis -->
    <script>
        // Global variables for fraud analysis
        let currentFraudType = null;
        let currentFraudAnalysis = null;

        // Test functions for debugging
        window.testAIDisplayWithHardcodedData = function() {
            console.log('Testing AI display with hardcoded data...');
            
            const mockResult = {
                success: true,
                session_id: 'test_session_123',
                fraud_type: 'digital_fraud',
                analysis: {
                    monitoring_analysis: {
                        api_call_analysis: [
                            {
                                api_endpoint: '/api/fraud/check',
                                http_method: 'POST',
                                request_purpose: 'Fraud risk assessment for transaction',
                                response_analysis: 'API call completed successfully with risk score calculated',
                                is_successful: true,
                                error_details: null,
                                fraud_relevance: 'Primary fraud detection mechanism',
                                risk_indicators: ['high_velocity_transaction', 'new_device'],
                                business_impact: 'Critical for transaction approval decision',
                                recommendations: 'Continue monitoring velocity patterns',
                                processing_time_ms: 250,
                                status_code: 200,
                                confidence_score: 0.85,
                                timestamp: '2025-01-03T10:30:00Z',
                                log_level: 'INFO',
                                source_type: 'api_gateway',
                                session_id: 'test_session_123',
                                original_message: 'Fraud check completed for session',
                                component: 'fraud-service',
                                raw_log_id: 'log_123'
                            },
                            {
                                api_endpoint: '/api/payment/process',
                                http_method: 'POST',
                                request_purpose: 'Process payment transaction',
                                response_analysis: 'Payment processing failed due to insufficient funds',
                                is_successful: false,
                                error_details: 'Insufficient funds in account',
                                fraud_relevance: 'Payment failure could indicate account compromise',
                                risk_indicators: ['payment_failure', 'insufficient_funds'],
                                business_impact: 'Transaction rejected, revenue loss',
                                recommendations: 'Verify account status and fraud indicators',
                                processing_time_ms: 150,
                                status_code: 402,
                                confidence_score: 0.92,
                                timestamp: '2025-01-03T10:30:05Z',
                                log_level: 'ERROR',
                                source_type: 'payment_gateway',
                                session_id: 'test_session_123',
                                original_message: 'Payment processing failed',
                                component: 'payment-service',
                                raw_log_id: 'log_124'
                            }
                        ],
                        ai_insights: {
                            overall_session_health: 'Session shows mixed results with successful fraud detection but payment processing issues',
                            key_findings: ['Fraud detection working properly', 'Payment processing failed', 'High risk indicators present'],
                            fraud_risk_assessment: 'Medium risk due to payment failures and velocity patterns',
                            critical_issues: ['Payment processing failure', 'Insufficient funds error'],
                            positive_indicators: ['Fraud detection system active', 'Risk scoring operational'],
                            recommended_actions: [
                                'Review account balance verification process',
                                'Implement enhanced fraud monitoring for failed payments',
                                'Consider payment retry mechanisms'
                            ],
                            session_score: 65,
                            confidence_level: 'high'
                        },
                        summary_statistics: {
                            total_api_calls: 2,
                            successful_calls: 1,
                            failed_calls: 1,
                            success_rate: 0.5,
                            unique_endpoints: 2,
                            error_types: {'business_logic_errors': 1}
                        }
                    },
                    order_classification: {
                        type: 'purchase',
                        confidence: 0.85,
                        amount: 150.00,
                        currency: 'USD'
                    },
                    customer_type: {
                        type: 'existing_customer',
                        confidence: 0.75,
                        customer_id: 'cust_123456'
                    },
                    risk_assessment: {
                        level: 'MEDIUM',
                        score: 65,
                        color: '#ffaa00',
                        factors: ['Payment processing failure', 'High velocity transaction patterns']
                    },
                    recommendations: [
                        'Review payment processing workflow',
                        'Enhance account balance verification',
                        'Monitor transaction velocity patterns'
                    ],
                    statistics: {
                        total_logs_analyzed: 15,
                        fraud_calls_triggered: 2,
                        fraud_call_success_rate: 0.5,
                        risk_scores_recorded: 1,
                        decisions_made: 2
                    },
                    timeline: [
                        {
                            timestamp: '2025-01-03T10:30:00Z',
                            event: 'Fraud Detection: risk_calculator',
                            status: 'Success',
                            details: 'Risk score calculated successfully'
                        },
                        {
                            timestamp: '2025-01-03T10:30:05Z',
                            event: 'Payment Processing: process_payment',
                            status: 'Failed',
                            details: 'Payment processing failed due to insufficient funds'
                        }
                    ]
                }
            };
            
            console.log('Displaying hardcoded mock data:', mockResult);
            if (typeof displayFraudResults === 'function') {
                displayFraudResults(mockResult);
            } else {
                console.error('displayFraudResults function not found. Make sure main.js is loaded.');
            }
        };

        // Quick test function accessible from console
        window.quickTestAI = function() {
            console.log('Running quick AI test...');
            
            // Switch to fraud tab first
            if (typeof showTab === 'function') {
                showTab('fraud');
            }
            
            // Wait a moment, then run test
            setTimeout(() => {
                if (typeof testAIDisplayWithHardcodedData === 'function') {
                    testAIDisplayWithHardcodedData();
                } else {
                    window.testAIDisplayWithHardcodedData();
                }
            }, 500);
        };

        // Add helpful console message
        console.log('🚨 Fraud Analysis Debug Tools Available:');
        console.log('- quickTestAI() - Quick test of AI display');
        console.log('- testAIDisplayWithHardcodedData() - Test with mock data');
        console.log('- debugFraudAnalysis() - Debug current analysis (after running analysis)');
    </script>
</body>
</html>
